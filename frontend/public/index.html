<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaoMeasure</title>
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <link rel="stylesheet" href="./styles/main.css">
    <link rel="stylesheet" href="./styles/curve-design.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <header>
            <div class="logo">
                <i class="fas fa-compass"></i>
                TaoMeasure
            </div>
            <div class="header-info">
                <span>Lingzhentaor</span>
            </div>
        </header>

        <!-- 菜单栏 -->
        <div class="menu-bar">
            <div class="menu-item disabled" onclick="fileHandler.showFileUploadDialog()">
                <i class="fas fa-file-import"></i> 导入文件
            </div>
            <div class="menu-item disabled" onclick="exportManager.showExportDialog()">
                <i class="fas fa-file-export"></i> 导出结果
            </div>
            <div class="menu-item disabled">
                <i class="fas fa-eye"></i> 视图
            </div>
            <div class="menu-item disabled">
                <i class="fas fa-window-maximize"></i> 窗口
            </div>
            <div class="menu-item">
                <i class="fas fa-question-circle"></i> 帮助
            </div>
        </div>

        <!-- 主要内容区域 -->
        <div class="main-content">
            <!-- 侧边栏 -->
            <div class="sidebar">
                <!-- GPS高程转换模块 -->
                <div class="module-group">
                    <div class="module-group-title">
                        <i class="fas fa-satellite"></i>
                        GPS高程转换
                    </div>
                    <div class="sub-module-list">
                        <button class="sub-module-btn active" data-module="gps" data-function="verticalTranslation">
                            <i class="fas fa-arrows-alt-v"></i>
                            垂直平移模型
                        </button>
                        <button class="sub-module-btn" data-module="gps" data-function="linearFitting">
                            <i class="fas fa-chart-line"></i>
                            线性基函数拟合
                        </button>
                        <button class="sub-module-btn" data-module="gps" data-function="surfaceFitting">
                            <i class="fas fa-cube"></i>
                            面基函数拟合
                        </button>
                    </div>
                </div>

                <!-- 坐标转换模块 -->
                <div class="module-group">
                    <div class="module-group-title">
                        <i class="fas fa-exchange-alt"></i>
                        坐标转换
                    </div>
                    <div class="sub-module-list">
                        <button class="sub-module-btn" data-module="coordinate" data-function="universal">
                            <i class="fas fa-globe"></i>
                            全能坐标转换
                        </button>
                    </div>
                </div>

                <!-- 曲线测设模块 -->
                <div class="module-group">
                    <div class="module-group-title">
                        <i class="fas fa-route"></i>
                        曲线测设
                    </div>
                    <div class="sub-module-list">
                        <button class="sub-module-btn" data-module="curve" data-function="transitionCurve">
                            <i class="fas fa-bezier-curve"></i>
                            对称基本型曲线测设
                        </button>
                        
                    </div>
                </div>
            </div>

            <!-- 内容区域 -->
            <div class="content-area">
                <!-- GPS高程转换模块工作区 -->
                <div class="work-area" id="gps-work-area">
                    <!-- 功能标题区域 -->
                    <div class="function-header">
                        <div class="function-title">
                            <i class="fas fa-satellite"></i>
                            <span id="currentFunctionTitle">GPS高程转换 - 垂直平移模型</span>
                        </div>
                        <div class="function-description" id="functionDescription">
                            适用于小范围、高程异常变化平缓区域（如平原操场、厂房区）
                        </div>
                    </div>

                    <!-- 计算区域 -->
                    <div class="calculation-area">
                        <!-- 表格容器 -->
                        <div class="table-container">
                            <!-- 工具栏 -->
                            <div class="table-toolbar">
                                <button class="tool-btn" id="settingsBtn"><i class="fas fa-cog"></i> 计算方案</button>
                                <button class="tool-btn" id="importKnownBtn"><i class="fas fa-upload"></i> 导入已知点</button>
                                <button class="tool-btn" id="importUnknownBtn"><i class="fas fa-upload"></i> 导入未知点</button>
                                <button class="tool-btn primary" id="calculateBtn"><i class="fas fa-play"></i> 开始计算</button>
                                <button class="tool-btn" id="exportBtn"><i class="fas fa-download"></i> 结果导出</button>
                            </div>

                            <!-- 选项卡 -->
                            <div class="tabs">
                                <div class="tab active" data-tab="known">已知点</div>
                                <div class="tab" data-tab="unknown">未知点</div>
                            </div>

                            <!-- 表格内容 -->
                            <div class="table-content">
                                <div class="project-info">
                                    <div class="info-row">
                                        <label>工程名称: <input type="text" id="projectName" placeholder="请输入工程名称"></label>
                                        <span class="page-info">第 <input type="number" id="currentPage" value="1" min="1"> 页 共 <span id="totalPages">1</span> 页</span>
                                    </div>
                                </div>
                                <div class="table-panel active" id="knownPointsTable">
                                    <div class="table-wrapper">
                                        <table class="data-table" id="knownPointsDataTable">
                                            <thead>
                                                <tr>
                                                    <th width="50"><input type="checkbox" id="selectAllKnown"></th>
                                                    <th width="100">点名</th>
                                                    <th width="120">纬度</th>
                                                    <th width="120">经度</th>
                                                    <th width="100">大地高(m)</th>
                                                    <th width="100">高程异常(m)</th>
                                                    <th width="100" class="calculated">正常高(m)</th>
                                                    <th width="150">备注</th>
                                                </tr>
                                            </thead>
                                            <tbody id="knownPointsBody"></tbody>
                                        </table>
                                    </div>
                                    <div class="table-actions">
                                        <button class="action-btn" id="addKnownRowBtn"><i class="fas fa-plus"></i> 添加行</button>
                                        <button class="action-btn" id="deleteKnownRowBtn"><i class="fas fa-trash"></i> 删除选中行</button>
                                        <button class="action-btn" id="clearKnownBtn"><i class="fas fa-eraser"></i> 清空数据</button>
                                    </div>
                                </div>
                                <div class="table-panel" id="unknownPointsTable">
                                    <div class="table-wrapper">
                                        <table class="data-table" id="unknownPointsDataTable">
                                            <thead>
                                                <tr>
                                                    <th width="50"><input type="checkbox" id="selectAllUnknown"></th>
                                                    <th width="100">点名</th>
                                                    <th width="120">纬度</th>
                                                    <th width="120">经度</th>
                                                    <th width="100">大地高(m)</th>
                                                    <th width="120" class="calculated">计算高程异常(m)</th>
                                                    <th width="100" class="calculated">正常高(m)</th>
                                                </tr>
                                            </thead>
                                            <tbody id="unknownPointsBody"></tbody>
                                        </table>
                                    </div>
                                    <div class="table-actions">
                                        <button class="action-btn" id="addUnknownRowBtn"><i class="fas fa-plus"></i> 添加行</button>
                                        <button class="action-btn" id="deleteUnknownRowBtn"><i class="fas fa-trash"></i> 删除选中行</button>
                                        <button class="action-btn" id="clearUnknownBtn"><i class="fas fa-eraser"></i> 清空数据</button>
                                    </div>
                                </div>
                                <div class="responsibility-info">
                                    <label>计算: <input type="text" id="calculator" placeholder="计算员"></label>
                                    <label>复核: <input type="text" id="checker" placeholder="复核员"></label>
                                    <label>日期: <input type="date" id="calcDate"></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 坐标转换工作区域 -->
                <div class="work-area" id="coordinate-work-area" style="display: none;">
                    <div class="content-header">
                        <h2 id="coordinate-function-title">综合坐标转换</h2>
                        <div class="header-tools">
                            <button class="tool-btn primary" id="universal-compute-all"><i class="fas fa-play-circle"></i> 全面计算</button>
                        </div>
                    </div>

                    <div id="coordinate-default-content" class="function-content" style="display: none;">
                        <div class="placeholder-content">
                            <i class="fas fa-drafting-compass"></i>
                            <p>新的综合坐标转换模块已启用，请点击上方按钮导入数据或添加点。</p>
                        </div>
                    </div>

                    <div id="coordinate-universal-content" class="function-content universal-coordinate">
                        <section class="panel" id="common-points-panel">
                                <div class="panel-header">
                                    <h3><i class="fas fa-share-alt"></i> 公共点</h3>
                                    <div class="panel-tools">
                                        <button class="mini-btn" id="common-import-btn"><i class="fas fa-file-import"></i> 导入</button>
                                        <button class="mini-btn" id="common-export-btn"><i class="fas fa-file-export"></i> 导出</button>
                                        <button class="mini-btn" id="common-add-row"><i class="fas fa-plus"></i> 新增行</button>
                                        <button class="mini-btn" id="universal-clear-common"><i class="fas fa-eraser"></i> 清空</button>
                                    </div>
                                </div>
                            <div class="table-scroll">
                                <table id="common-points-table" class="data-table">
                                    <thead>
                                        <tr>
                                            <th rowspan="2">点名</th>
                                            <th colspan="9">原坐标系</th>
                                            <th colspan="9">目标坐标系</th>
                                        </tr>
                                        <tr>
                                            <th>B (°)</th>
                                            <th>L (°)</th>
                                            <th>H (m)</th>
                                            <th>X (m)</th>
                                            <th>Y (m)</th>
                                            <th>Z (m)</th>
                                            <th>x (m)</th>
                                            <th>y (m)</th>
                                            <th>h (m)</th>
                                            <th>B (°)</th>
                                            <th>L (°)</th>
                                            <th>H (m)</th>
                                            <th>X (m)</th>
                                            <th>Y (m)</th>
                                            <th>Z (m)</th>
                                            <th>x (m)</th>
                                            <th>y (m)</th>
                                            <th>h (m)</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </section>

                        <div class="panel-grid two-column">
                            <section class="panel" id="seven-parameter-panel">
                                <div class="panel-header">
                                    <h3><i class="fas fa-cube"></i> 七参数</h3>
                                    <div class="panel-tools">
                                        <label class="inline-label"><input type="checkbox" id="seven-manual-toggle"> 手动录入</label>
                                    </div>
                                </div>
                                <div class="parameter-grid" id="seven-parameter-grid">
                                    <div class="parameter-field">
                                        <label for="seven-dx">ΔX (m)</label>
                                        <input type="number" id="seven-dx" data-field="dx" step="0.001" class="parameter-input" readonly>
                                    </div>
                                    <div class="parameter-field">
                                        <label for="seven-dy">ΔY (m)</label>
                                        <input type="number" id="seven-dy" data-field="dy" step="0.001" class="parameter-input" readonly>
                                    </div>
                                    <div class="parameter-field">
                                        <label for="seven-dz">ΔZ (m)</label>
                                        <input type="number" id="seven-dz" data-field="dz" step="0.001" class="parameter-input" readonly>
                                    </div>
                                    <div class="parameter-field">
                                        <label for="seven-rx">εX (″)</label>
                                        <input type="number" id="seven-rx" data-field="rx_arcsec" step="0.001" class="parameter-input" readonly>
                                    </div>
                                    <div class="parameter-field">
                                        <label for="seven-ry">εY (″)</label>
                                        <input type="number" id="seven-ry" data-field="ry_arcsec" step="0.001" class="parameter-input" readonly>
                                    </div>
                                    <div class="parameter-field">
                                        <label for="seven-rz">εZ (″)</label>
                                        <input type="number" id="seven-rz" data-field="rz_arcsec" step="0.001" class="parameter-input" readonly>
                                    </div>
                                    <div class="parameter-field">
                                        <label for="seven-scale">尺度 (ppm)</label>
                                        <input type="number" id="seven-scale" data-field="scale_ppm" step="0.001" class="parameter-input" readonly>
                                    </div>
                                </div>
                                <div class="parameter-meta" id="seven-parameter-meta"></div>
                            </section>

                            <section class="panel" id="four-parameter-panel">
                                <div class="panel-header">
                                    <h3><i class="fas fa-ruler-combined"></i> 四参数</h3>
                                    <div class="panel-tools">
                                        <label class="inline-label"><input type="checkbox" id="four-manual-toggle"> 手动录入</label>
                                    </div>
                                </div>
                                <div class="parameter-grid" id="four-parameter-grid">
                                    <div class="parameter-field">
                                        <label for="four-dx">Δx (m)</label>
                                        <input type="number" id="four-dx" data-field="dx" step="0.001" class="parameter-input" readonly>
                                    </div>
                                    <div class="parameter-field">
                                        <label for="four-dy">Δy (m)</label>
                                        <input type="number" id="four-dy" data-field="dy" step="0.001" class="parameter-input" readonly>
                                    </div>
                                    <div class="parameter-field">
                                        <label for="four-rotation">旋转 (″)</label>
                                        <input type="number" id="four-rotation" data-field="rotation_arcsec" step="0.001" class="parameter-input" readonly>
                                    </div>
                                    <div class="parameter-field">
                                        <label for="four-scale">尺度 (ppm)</label>
                                        <input type="number" id="four-scale" data-field="scale_ppm" step="0.001" class="parameter-input" readonly>
                                    </div>
                                </div>
                                <div class="parameter-meta" id="four-parameter-meta"></div>
                            </section>
                        </div>

                        <div class="panel-grid two-column">
                            <section class="panel" id="source-system-panel">
                                <div class="panel-header">
                                    <h3><i class="fas fa-map-marker-alt"></i> 原坐标系参数</h3>
                                </div>
                                <div class="system-form" id="source-system-form">
                                    <div class="form-row">
                                        <label>坐标系名称</label>
                                        <input type="text" class="system-input" data-target="name" placeholder="如: 原始坐标系">
                                    </div>
                                    <div class="form-row">
                                        <label>参考椭球</label>
                                        <select class="system-select ellipsoid-select" data-target="ellipsoid.name"></select>
                                    </div>
                                    <div class="form-row two">
                                        <label>长半轴 a (m)</label>
                                        <input type="number" class="system-input" data-target="ellipsoid.a" step="0.001">
                                        <label>扁率分母 1/f</label>
                                        <input type="number" class="system-input" data-target="ellipsoid.inverse_flattening" step="0.000001">
                                    </div>
                                    <div class="form-row two">
                                        <label>中央子午线 (°)</label>
                                        <input type="number" class="system-input" data-target="projection.central_meridian" step="0.000001">
                                        <label>带宽 (°)</label>
                                        <input type="number" class="system-input" data-target="projection.zone_width" step="0.1" value="3">
                                    </div>
                                    <div class="form-row two">
                                        <label>Y轴加常数 (m)</label>
                                        <input type="number" class="system-input" data-target="projection.false_easting" step="0.001" value="500000">
                                        <label>假北 (m)</label>
                                        <input type="number" class="system-input" data-target="projection.false_northing" step="0.001" value="0">
                                    </div>
                                    <div class="form-row two">
                                        <label>尺度因子 k0</label>
                                        <input type="number" class="system-input" data-target="projection.scale_factor" step="0.000001" value="1">
                                        <label>投影面高 (m)</label>
                                        <input type="number" class="system-input" data-target="projection.projection_height" step="0.001" value="0">
                                    </div>
                                    <div class="form-row">
                                        <label>大地水准面差 (m)</label>
                                        <input type="number" class="system-input" data-target="geoid.undulation" step="0.001" value="0">
                                    </div>
                                </div>
                            </section>

                            <section class="panel" id="target-system-panel">
                                <div class="panel-header">
                                    <h3><i class="fas fa-map-marked-alt"></i> 目标坐标系参数</h3>
                                </div>
                                <div class="system-form" id="target-system-form">
                                    <div class="form-row">
                                        <label>坐标系名称</label>
                                        <input type="text" class="system-input" data-target="name" placeholder="如: 目标坐标系">
                                    </div>
                                    <div class="form-row">
                                        <label>参考椭球</label>
                                        <select class="system-select ellipsoid-select" data-target="ellipsoid.name"></select>
                                    </div>
                                    <div class="form-row two">
                                        <label>长半轴 a (m)</label>
                                        <input type="number" class="system-input" data-target="ellipsoid.a" step="0.001">
                                        <label>扁率分母 1/f</label>
                                        <input type="number" class="system-input" data-target="ellipsoid.inverse_flattening" step="0.000001">
                                    </div>
                                    <div class="form-row two">
                                        <label>中央子午线 (°)</label>
                                        <input type="number" class="system-input" data-target="projection.central_meridian" step="0.000001">
                                        <label>带宽 (°)</label>
                                        <input type="number" class="system-input" data-target="projection.zone_width" step="0.1" value="3">
                                    </div>
                                    <div class="form-row two">
                                        <label>Y轴加常数 (m)</label>
                                        <input type="number" class="system-input" data-target="projection.false_easting" step="0.001" value="500000">
                                        <label>假北 (m)</label>
                                        <input type="number" class="system-input" data-target="projection.false_northing" step="0.001" value="0">
                                    </div>
                                    <div class="form-row two">
                                        <label>尺度因子 k0</label>
                                        <input type="number" class="system-input" data-target="projection.scale_factor" step="0.000001" value="1">
                                        <label>投影面高 (m)</label>
                                        <input type="number" class="system-input" data-target="projection.projection_height" step="0.001" value="0">
                                    </div>
                                    <div class="form-row">
                                        <label>大地水准面差 (m)</label>
                                        <input type="number" class="system-input" data-target="geoid.undulation" step="0.001" value="0">
                                    </div>
                                </div>
                            </section>
                        </div>

                        <section class="panel" id="points-panel">
                            <div class="panel-header">
                                <h3><i class="fas fa-list"></i> 待转换点</h3>
                                <div class="panel-tools">
                                    <button class="mini-btn" id="points-import-btn"><i class="fas fa-file-import"></i> 导入</button>
                                    <button class="mini-btn" id="points-export-btn"><i class="fas fa-file-export"></i> 导出</button>
                                    <button class="mini-btn" id="points-add-row"><i class="fas fa-plus"></i> 新增行</button>
                                    <button class="mini-btn" id="universal-clear-points"><i class="fas fa-eraser"></i> 清空</button>
                                </div>
                            </div>
                            <div class="table-scroll">
                                <table id="points-table" class="data-table">
                                    <thead>
                                        <tr>
                                            <th>点名</th>
                                            <th>B (°)</th>
                                            <th>L (°)</th>
                                            <th>H (m)</th>
                                            <th>X (m)</th>
                                            <th>Y (m)</th>
                                            <th>Z (m)</th>
                                            <th>x (m)</th>
                                            <th>y (m)</th>
                                            <th>h (m)</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </section>

                        <section class="panel" id="results-panel">
                            <div class="panel-header">
                                <h3><i class="fas fa-check-circle"></i> 转换结果</h3>
                                <div class="panel-tools">
                                    <button class="mini-btn" id="results-import-btn"><i class="fas fa-file-import"></i> 导入</button>
                                    <button class="mini-btn" id="results-export-btn"><i class="fas fa-file-export"></i> 导出</button>
                                </div>
                            </div>
                            <div class="table-scroll">
                                <table id="results-table" class="data-table">
                                    <thead>
                                        <tr>
                                            <th>点名</th>
                                            <th>B (°)</th>
                                            <th>L (°)</th>
                                            <th>H (m)</th>
                                            <th>X (m)</th>
                                            <th>Y (m)</th>
                                            <th>Z (m)</th>
                                            <th>x (m)</th>
                                            <th>y (m)</th>
                                            <th>h (m)</th>
                                            <th>备注</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </section>

                        <section class="panel" id="diagnostics-panel">
                            <div class="panel-header">
                                <h3><i class="fas fa-info-circle"></i> 诊断信息</h3>
                            </div>
                            <ul id="universal-messages" class="message-list"></ul>
                        </section>
                    </div>
                </div>

                <!-- 综合坐标转换导入模态框 -->
                <div class="modal" id="universalImportModal">
                    <div class="modal-content modal-large">
                        <div class="modal-header">
                            <h3><i class="fas fa-file-import"></i> 导入坐标数据</h3>
                            <button class="modal-close" data-close-modal="universalImportModal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-row">
                                <label>目标表格</label>
                                <select id="universal-import-target" class="system-select">
                                    <option value="common">公共点表</option>
                                    <option value="points">待转换点表</option>
                                    <option value="seven">七参数</option>
                                    <option value="four">四参数</option>
                                    <option value="source_system">原坐标系参数</option>
                                    <option value="target_system">目标坐标系参数</option>
                                </select>
                            </div>
                            <div class="form-row">
                                <label>数据说明</label>
                                <p class="hint-text">支持CSV/空格分隔或 key=value 形式，可直接粘贴Excel内容。</p>
                            </div>
                            <textarea id="universal-import-raw" rows="12" placeholder="点名,B,L,H,X,Y,Z,x,y,h,B,L,H,X,Y,Z,x,y,h"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button class="tool-btn" data-close-modal="universalImportModal">取消</button>
                            <button class="tool-btn primary" id="universal-import-confirm">导入</button>
                        </div>
                    </div>
                </div>

                <!-- 字段映射模态框 -->
                <div class="modal" id="fieldMappingModal">
                    <div class="modal-content modal-large">
                        <div class="modal-header">
                            <h3><i class="fas fa-exchange-alt"></i> 字段映射</h3>
                            <button class="modal-close" data-close-modal="fieldMappingModal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-row">
                                <label>数据预览</label>
                                <div id="data-preview" class="data-preview-container"></div>
                            </div>
                            <div class="form-row">
                                <label>字段映射</label>
                                <div id="field-mapping-container" class="field-mapping-container"></div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="tool-btn" id="cancelFieldMapping">取消</button>
                            <button class="tool-btn primary" id="field-mapping-confirm">确认映射</button>
                        </div>
                    </div>
                </div>

                <!-- 曲线测设工作区域 -->
                <div class="work-area" id="curve-work-area" style="display: none;">
                    <!-- 默认提示信息 -->
                    <div id="curve-default-content" class="function-content-wrapper">
                        <div class="placeholder-content">
                            <i class="fas fa-route"></i>
                            <p>请从左侧选择一个曲线测设功能。</p>
                        </div>
                    </div>

                    <!-- 对称基本型曲线测设 -->
                    <div id="transitionCurve-content" class="function-content-wrapper" style="display: none;">
                        <!-- 功能标题区域 -->
                        <div class="function-header">
                            <div class="function-title">
                                <i class="fas fa-bezier-curve"></i>
                                <span id="currentCurveFunctionTitle">曲线测设 - 对称基本型曲线测设</span>
                            </div>
                            <div class="function-description" id="curveFunctionDescription">
                                核心功能，支持“综合要素计算→主点坐标→中桩坐标→边桩坐标→DXF导出”全流程
                            </div>
                        </div>

                        
                    </div>
                </div>
        </div>
    </div>

    <!-- 垂直平移模型计算方案设置 -->
    <div class="modal" id="verticalTranslationSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>垂直平移模型 - 计算方案设置</h3>
                <button class="modal-close" onclick="closeModal('xyzToBLHSettingsModal')">&times;</button>
            </div>
            <div class="modal-body">

                <!-- 模型说明 -->
                <div class="param-group">
                    <h4><i class="fas fa-info-circle"></i> 模型说明</h4>
                    <div class="model-description">
                        <p><strong>垂直平移模型</strong>适用于小范围、高程异常变化平缓的区域。</p>
                        <p><strong>计算公式:</strong> ζ̄ = (1/n) × Σζᵢ</p>
                        <p><strong>适用场景:</strong> 平原操场、厂房区等小范围区域</p>
                        <p><strong>最少点数:</strong> ≥1个已知GPS水准点</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="tool-btn" onclick="closeModal('verticalTranslationSettingsModal')">取消</button>
                <button class="tool-btn" onclick="showHelp('verticalTranslation')">帮助</button>
                <button class="tool-btn primary" id="saveVerticalSettingsBtn">确定</button>
            </div>
        </div>
    </div>

    <!-- 线性基函数拟合计算方案设置 -->
    <div class="modal" id="linearFittingSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>线性基函数拟合 - 计算方案设置</h3>
                <button class="modal-close" onclick="closeModal('blhToXYZSettingsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 线性模型专属参数 -->
                <div class="param-group">
                    <h4><i class="fas fa-route"></i> 独立线路坐标系参数</h4>
                    <div class="param-row">
                        <label class="param-label">中央子午线:</label>
                        <select class="param-input" name="central_meridian_type">
                            <option value="auto">测区平均经度（默认）</option>
                            <option value="manual">手动输入</option>
                        </select>
                    </div>
                    <div class="param-row manual-meridian" style="display: none;">
                        <label class="param-label">中央子午线(°′″):</label>
                        <input type="text" class="param-input" name="central_meridian_manual" value="114°00′00″" placeholder="如: 114°00′00″">
                    </div>
                    <div class="param-row">
                        <label class="param-label">抵偿高程面:</label>
                        <select class="param-input" name="compensation_height_type">
                            <option value="auto">测区平均大地高（默认）</option>
                            <option value="manual">手动输入</option>
                        </select>
                    </div>
                    <div class="param-row manual-height" style="display: none;">
                        <label class="param-label">抵偿高程面(m):</label>
                        <input type="number" class="param-input" name="compensation_height_manual" value="0" step="0.001">
                    </div>
                    <div class="param-row">
                        <label class="param-label">中线起点:</label>
                        <select class="param-input" name="centerline_origin_type">
                            <option value="auto">系统拟合（默认）</option>
                            <option value="manual">手动输入</option>
                        </select>
                    </div>
                    <div class="param-row manual-origin" style="display: none;">
                        <label class="param-label">起点纬度(°′″):</label>
                        <input type="text" class="param-input" name="origin_latitude" placeholder="如: 23°10′00″">
                    </div>
                    <div class="param-row manual-origin" style="display: none;">
                        <label class="param-label">起点经度(°′″):</label>
                        <input type="text" class="param-input" name="origin_longitude" placeholder="如: 114°00′00″">
                    </div>
                </div>

                <!-- 拟合模型选择 -->
                <div class="param-group">
                    <h4><i class="fas fa-chart-line"></i> 拟合模型选择</h4>
                    <div class="param-row">
                        <label class="param-label">模型类型:</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="fitting_model" value="linear" checked>
                                <span>直线模型: ζᵢ = α₀ + α₁yᵢ</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="fitting_model" value="quadratic">
                                <span>二次曲线模型: ζᵢ = α₀ + α₁yᵢ + α₂yᵢ²（默认）</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- 模型说明 -->
                <div class="param-group">
                    <h4><i class="fas fa-info-circle"></i> 模型说明</h4>
                    <div class="model-description">
                        <p><strong>线性基函数拟合</strong>适用于铁路、公路等线性工程。</p>
                        <p><strong>适用场景:</strong> 线性工程，含独立线路坐标系建立</p>
                        <p><strong>最少点数:</strong> 直线模型≥2个点，二次曲线模型≥3个点</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="tool-btn" onclick="closeModal('linearFittingSettingsModal')">取消</button>
                <button class="tool-btn" onclick="showHelp('linearFitting')">帮助</button>
                <button class="tool-btn primary" id="saveLinearSettingsBtn">确定</button>
            </div>
        </div>
    </div>

    <!-- 面基函数拟合计算方案设置 -->
    <div class="modal" id="surfaceFittingSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>面基函数拟合 - 计算方案设置</h3>
                <button class="modal-close" onclick="closeModal('xyzToBLHSettingsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 面拟合专属参数 -->
                <div class="param-group">
                    <h4><i class="fas fa-map-marked-alt"></i> 参考点设置</h4>
                    <div class="param-row">
                        <label class="param-label">参考点选择:</label>
                        <select class="param-input" name="reference_point_type">
                            <option value="auto">自动选择（测区中心）</option>
                            <option value="select">从已知点中选择</option>
                            <option value="manual">手动输入坐标</option>
                        </select>
                    </div>
                    <div class="param-row select-reference" style="display: none;">
                        <label class="param-label">选择已知点:</label>
                        <select class="param-input" name="reference_point_name">
                            <option value="">请先添加已知点数据</option>
                        </select>
                    </div>
                    <div class="param-row manual-reference" style="display: none;">
                        <label class="param-label">参考点纬度(°′″):</label>
                        <input type="text" class="param-input" name="reference_latitude" placeholder="如: 23°10′00″">
                    </div>
                    <div class="param-row manual-reference" style="display: none;">
                        <label class="param-label">参考点经度(°′″):</label>
                        <input type="text" class="param-input" name="reference_longitude" placeholder="如: 114°00′00″">
                    </div>
                </div>

                <!-- 拟合模型选择 -->
                <div class="param-group">
                    <h4><i class="fas fa-cube"></i> 拟合模型选择</h4>
                    <div class="param-row">
                        <label class="param-label">模型类型:</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="surface_model" value="plane">
                                <span>平面模型: ζᵢ = α₀ + α₁ΔBᵢ + α₃ΔLᵢ</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="surface_model" value="quadratic" checked>
                                <span>二次曲面模型: ζᵢ = α₀ + α₁ΔBᵢ + α₂ΔBᵢ² + α₃ΔLᵢ + α₄ΔLᵢ² + α₅ΔBᵢΔLᵢ（默认）</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- 模型说明 -->
                <div class="param-group">
                    <h4><i class="fas fa-info-circle"></i> 模型说明</h4>
                    <div class="model-description">
                        <p><strong>面基函数拟合</strong>适用于大面积、地形略有起伏的面状区域。</p>
                        <p><strong>适用场景:</strong> 大面积测区，含参考点设置</p>
                        <p><strong>最少点数:</strong> 平面模型≥3个点，二次曲面模型≥6个点</p>
                        <p><strong>参考点建议:</strong> 选择靠近测区中心位置的已知点</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="tool-btn" onclick="closeModal('surfaceFittingSettingsModal')">取消</button>
                <button class="tool-btn" onclick="showHelp('surfaceFitting')">帮助</button>
                <button class="tool-btn primary" id="saveSurfaceSettingsBtn">确定</button>
            </div>
        </div>
    </div>

    <!-- 数据导入模态框 -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="importModalTitle">导入已知点数据</h3>
                <button class="modal-close" onclick="closeModal('blhToXYZSettingsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="import-tabs">
                    <div class="import-tab active" data-tab="file">文件导入</div>
                    <div class="import-tab" data-tab="manual">手动输入</div>
                </div>
                
                <div class="import-content">
                    <!-- 文件导入 -->
                    <div class="import-panel active" id="fileImportPanel">
                        <div class="file-upload" id="dropZone">
                            <i class="fas fa-calculator mb-16 upload-icon-large"></i>
                            <p>拖拽文件到此处或点击选择文件</p>
                            <p class="text-small-muted">支持 TXT, DAT 格式</p>
                            <input type="file" id="fileInput" accept=".txt,.dat" style="display: none;">
                            <button class="tool-btn primary" onclick="document.getElementById('fileInput').click()">
                                <i class="fas fa-folder-open"></i> 选择文件
                            </button>
                        </div>
                        
                        <div class="file-format-info">
                            <h4>文件格式说明:</h4>
                            <p><strong>已知点格式:</strong> 点名 纬度 经度 大地高 高程异常</p>
                            <p><strong>未知点格式:</strong> 点名 纬度 经度 大地高</p>
                            <p><strong>示例:</strong></p>
                            <pre>GPS01 23°10′30″ 114°05′20″ 85.234 28.456
GPS02 23°11′15″ 114°06′10″ 86.123 28.523</pre>
                        </div>
                    </div>
                    
                    <!-- 手动输入 -->
                    <div class="import-panel" id="manualImportPanel">
                        <div class="manual-input-form">
                            <div class="input-row">
                                <label>点名:</label>
                                <input type="text" id="manualPointName" placeholder="如: GPS01">
                            </div>
                            <div class="input-row">
                                <label>纬度:</label>
                                <input type="text" id="manualLatitude" placeholder="如: 23°10′30″ 或 23.175">
                            </div>
                            <div class="input-row">
                                <label>经度:</label>
                                <input type="text" id="manualLongitude" placeholder="如: 114°05′20″ 或 114.089">
                            </div>
                            <div class="input-row">
                                <label>大地高(m):</label>
                                <input type="number" id="manualEllipsoidHeight" step="0.001" placeholder="如: 85.234">
                            </div>
                            <div class="input-row" id="manualHeightAnomalyRow">
                                <label>高程异常(m):</label>
                                <input type="number" id="manualHeightAnomaly" step="0.001" placeholder="如: 28.456">
                            </div>
                            <button class="tool-btn primary" id="addManualPointBtn">
                                <i class="fas fa-plus"></i> 添加到表格
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="tool-btn" onclick="closeModal('importModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 脚本文件 -->

    <script src="./scripts/notification-system.js" defer></script>
    <script src="./scripts/script.js" defer></script>
    <script src="./scripts/linear-surface-fitting.js" defer></script>
    <script src="./scripts/coordinate-universal.js" defer></script>
    <script src="./scripts/file-handler.js" defer></script>
    <script src="./scripts/export-enhanced.js" defer></script>
    <script src="./scripts/curve-design-service.js" defer></script>
    <script src="./scripts/dxf-export-service.js" defer></script>
    <script src="./scripts/curve-design.js" defer></script>
    <script src="./scripts/curve-combined-table.js" defer></script>
    <script src="./scripts/curve-export.js" defer></script>
</body>
</html>
